Mac 通用剪贴板历史管理工具  
产品需求文档（PRD）  
版本：v2.0  
作者：产品部 / 2025-01-27

————————————————————
1. 背景与机会
• 原生剪贴板只能保留最后一项，设计师、运营、开发在日常工作中经常需要复用颜色值、图片、代码片段、链接等多类型内容，反复切换窗口查找效率低。  
• 现有竞品（Paste、Copied、Maccy）要么仅支持文本 / 图片，要么界面笨重、无中文搜索、无团队协作能力。  
• 机会：在跨平台原生体验之上，打造一款"极简、极速、全类型"的剪贴板历史管理器，并支持团队共享库，形成差异化竞争。

2. 产品目标
1. 让任何可复制的内容（文字、富文本、图片、文件、颜色、音频、视频）在 1 秒内可被再次粘贴。  
2. 让设计师 3 秒内找到上次复制的品牌色值。  
3. 让运营 5 秒内复用常用文案模板。  
4. 让团队共享素材库，减少重复沟通。

3. 目标用户
• 主要：UI/UX 设计师、前端开发、新媒体运营、产品经理。  
• 次要：普通 Mac/Windows 用户想提升日常效率。

4. 需求范围
4.1 版本策略  
MVP（v1.0）：跨平台基础功能、本地存储、核心类型支持。  
v1.1：iCloud/OneDrive 同步、团队协作、插件市场。  
v2.0：AI 摘要、智能标签、高级搜索。

4.2 功能总览（更新版）
| 模块 | 功能点 | 可行性 | MVP | v1.1 | v2.0 |
|---|---|---|---|---|---|
| 捕获 | 系统剪贴板监听 | 90% | ✅ | ✅ | ✅ |
| 存储 | 本地 SQLite、AES-256 加密 | 100% | ✅ | ✅ | ✅ |
| 搜索 | 全文 / 颜色 / 标签 / 基础OCR | 85% | ✅ | ✅ | ✅ |
| 预览 | 图片、富文本、颜色卡片 | 100% | ✅ | ✅ | ✅ |
| 粘贴 | 快捷键/拖拽/菜单 | 90% | ✅ | ✅ | ✅ |
| 同步 | iCloud/OneDrive | 80% | ❌ | ✅ | ✅ |
| 共享 | 团队库 | 70% | ❌ | ✅ | ✅ |
| AI | 摘要、智能标签 | 30% | ❌ | ❌ | ✅ |
| 平台 | Mac/Windows/Linux | 100% | ✅ | ✅ | ✅ |

5. 技术架构方案（更新版）
5.1 技术栈选择
• **前端框架**：Flutter 3.19+ (跨平台支持)
• **状态管理**：Riverpod (响应式状态管理)
• **数据库**：SQLite + drift (本地存储)
• **加密**：encrypt 包 (AES-256-GCM)
• **UI组件**：Material Design 3 + 自定义主题
• **平台集成**：window_manager, tray_manager

5.2 平台特定实现
• **Mac**：原生剪贴板API + 系统托盘
• **Windows**：Win32 API + 系统托盘
• **Linux**：X11/Wayland + 系统托盘

5.3 性能优化策略
• **启动时间**：≤ 800ms (M1 MacBook Air)
• **内存占用**：≤ 100MB (500条历史)
• **搜索响应**：≤ 50ms (10k条数据)
• **图片处理**：异步压缩 + 缓存

6. 详细需求（更新版）
6.1 核心用户故事
US-1 作为设计师，我复制了品牌主色 #007AFF，希望 3 秒内在任何 App 里再次粘贴该色值。  
US-2 作为运营，我复制了 5 张配图，希望一次性批量粘贴到公众号编辑器。  
US-3 作为开发，我复制了一段 JSON，希望粘贴时自动格式化缩进。  
US-4 作为团队成员，我希望把常用 Logo 上传到共享库，供同事直接使用。

6.2 功能规格（技术可行版）
6.2.1 剪贴板捕获  
• 类型：纯文本、富文本（RTF/HTML）、图片（PNG/JPG/SVG/HEIC）、颜色（十六进制、RGB、HSL）、文件/文件夹、音频（MP3/WAV）、视频（MP4/MOV）。  
• 策略：  
  – 默认保存最近 500 条；可自定义保留条数 / 时间。  
  – 大小限制：单条图片 ≤ 20 MB，视频 ≤ 100 MB（仅保存缩略图 + 路径）。
  – 敏感过滤：基于关键词匹配（密码、token等）

6.2.2 索引与搜索  
• 文本索引：全文 + 正则 + 中文分词。  
• 颜色索引：自动解析十六进制、RGB、HSL，支持近似色搜索（ΔE ≤ 3）。  
• 图片索引：  
  – 基础OCR（集成Tesseract），识别中文 / 英文。  
  – 色系聚类，提取主色（使用image包）。
• 标签：用户可手动打标签；支持智能建议（基于内容）。

6.2.3 主界面  
• 触发：全局快捷键 ⌘⇧V（Mac）/ Ctrl+Shift+V（Windows）（可自定义），或系统托盘图标点击。  
• UI 结构：  
  – 左侧：筛选器（全部 / 文本 / 图片 / 颜色 / 文件 / 收藏）。  
  – 中间：瀑布流卡片，支持 3 种密度（紧凑 / 默认 / 预览）。  
  – 右侧：详情面板（图片放大、颜色值可复制为 HEX/RGB/SwiftUI）。  
• 交互：  
  – 上下箭头 / ⌘J ⌘K 快速切换。  
  – 回车直接粘贴并关闭窗口；⌘↩ 仅复制不粘贴。  
  – 拖拽到任意 App 作为文件或文本。

6.2.4 批量处理  
• 多选：⌘ 点击 / ⇧ 范围选择。  
• 操作：合并为文本列表、批量重命名、批量导出 ZIP、批量上传团队库。

6.2.5 颜色专用增强  
• 颜色卡片：显示 HEX、RGB、HSL、SwiftUI Color、NSColor、CSS。  
• 快捷复制：单击即可复制对应格式。  
• Palette 生成：选中多张图片 → 提取主色 → 自动生成 .aco / .ase / .swatches 文件。

6.2.6 图片专用增强  
• 预览：Quick Look，支持放大、标记、裁剪、旋转。  
• 压缩：粘贴前可选压缩率（PNGQuant、MozJPEG）。  
• 生成：复制为 Base64、Markdown 语法、HTML <img> 标签。

6.2.7 快捷指令 & 自动化  
• Shortcuts 支持：获取剪贴板历史、写入指定条目、清空。  
• AppleScript / JXA 接口：供 Alfred、Raycast 等调用。  
• URL Scheme：  
  clipbook://paste?id=UUID  
  clipbook://search?q=hello&types=image,color

6.2.8 隐私与安全  
• 本地加密：AES-256-GCM，密码存储于钥匙串/Windows凭据管理器。  
• 敏感过滤：基于关键词匹配，自动忽略密码相关内容。  
• 无痕模式：系统托盘图标变灰，暂停记录，快捷键一键切换。  
• 清除策略：退出登录即擦除密钥，数据不可恢复。

6.2.9 性能约束  
• 启动时间 ≤ 800 ms（M1 MacBook Air）。  
• 内存占用 ≤ 100 MB（500 条历史）。  
• 搜索响应 ≤ 50 ms（10 k 条数据）。

7. 数据模型（更新版）
ClipItem  
├─ id: UUID  
├─ type: enum (text, rtf, html, image, color, file, audio, video)  
├─ content: blob（加密）  
├─ thumbnail: blob（加密，图片/视频首帧）  
├─ metadata: JSON  
│   ├─ createdAt: Date  
│   ├─ sourceApp: String?  
│   ├─ colorHex: String?  
│   ├─ ocrText: String?  
│   ├─ tags: [String]  
│   └─ fileSize: Int64?  
└─ isFavorite: Bool

8. 交互流程
触发 ⌘⇧V → 搜索框自动聚焦 → 输入关键字 → 实时过滤 → 回车粘贴 → 窗口关闭。  
长按 ⌥ 显示快捷菜单（复制为纯文本、复制为文件、删除等）。

9. 技术实现方案
9.1 核心服务架构
```
lib/
├── core/
│   ├── services/
│   │   ├── clipboard_service.dart      # 剪贴板监听服务
│   │   ├── database_service.dart       # 数据库服务
│   │   ├── encryption_service.dart     # 加密服务
│   │   ├── search_service.dart         # 搜索服务
│   │   └── sync_service.dart           # 同步服务
│   ├── models/
│   │   ├── clip_item.dart              # 剪贴板项目模型
│   │   └── user_preferences.dart       # 用户偏好设置
│   └── utils/
│       ├── color_utils.dart            # 颜色处理工具
│       ├── image_utils.dart            # 图片处理工具
│       └── platform_utils.dart         # 平台特定工具
├── features/
│   ├── home/                           # 主界面
│   ├── search/                         # 搜索功能
│   ├── settings/                       # 设置页面
│   └── team/                           # 团队功能
└── shared/
    ├── widgets/                        # 共享组件
    ├── providers/                      # 状态管理
    └── constants/                      # 常量定义
```

9.2 平台特定实现
• **Mac**: 使用NSPasteboard API + 系统托盘
• **Windows**: 使用Win32 API + 系统托盘
• **Linux**: 使用X11/Wayland + 系统托盘

10. 里程碑（更新版）
Week 1-2：技术预研（Flutter跨平台、数据库设计、加密方案）。  
Week 3-4：核心功能开发（剪贴板监听、存储、搜索）。  
Week 5-6：UI开发 + TestFlight α。  
Week 7-8：性能优化、本地化、β 测试。  
Week 9：应用商店提交 & 上线。

11. 成功指标（MVP）
• DAU/MAU ≥ 30%。  
• 平均查找时长 ≤ 4 秒（埋点统计）。  
• 次日留存 ≥ 45%。  
• 应用商店评分 ≥ 4.7。

12. 风险与对策（更新版）
| 风险 | 影响 | 对策 |
|---|---|---|
| Flutter跨平台性能问题 | 用户体验差 | 使用原生平台通道优化关键功能 |
| 剪贴板监听权限问题 | 无法捕获内容 | 提供详细权限说明和手动授权流程 |
| 图片OCR识别率低 | 搜索体验差 | 集成多个OCR引擎，支持手动输入 |
| 加密性能瓶颈 | 搜索慢 | 仅加密content，索引字段明文 |
| 平台特定API差异 | 功能不一致 | 统一抽象层，平台特定优化 |

13. 技术债务与优化计划
• **短期**：基础功能稳定，性能优化
• **中期**：AI功能集成，团队协作
• **长期**：跨平台同步，生态系统建设

14. 附件
• 竞品调研表（Notion）  
• 技术调研：Flutter跨平台方案.pdf
• 原型设计：Figma链接
• 开发计划：Jira项目链接