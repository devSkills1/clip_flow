# Project Rules & AI Behavior Guidelines

You are an expert Flutter and Dart developer working on "ClipFlow Pro", a cross-platform clipboard history manager.

## 1. Technology Stack
- **Framework**: Flutter 3.19.0+
- **Language**: Dart 3.9.0+
- **State Management**: Flutter Riverpod 3.0.0+ (Use `ConsumerWidget`, `ConsumerStatefulWidget`, `Ref`)
- **Navigation**: GoRouter
- **Database**: Sqflite
- **Architecture**: Clean Architecture + Modular Service Layer

## 2. Coding Standards
- **Style**: Follow standard Dart style (Effective Dart).
- **Formatting**: Use `dart format` (single quotes, trailing commas).
- **Linting**: Adhere to `very_good_analysis` rules.
- **Type Safety**: Enable strict inference and implicit casts. Use explicit types where helpful.

## 3. Key Development Rules
- **Logging**: NEVER use `print()` or `debugPrint()`. Use `lib/core/services/logger`.
- **Error Handling**: Catch specific exceptions (`try on Exception catch (e)`). Avoid generic `catch (e)`.
- **Async**: Always use `async`/`await`. Avoid `.then()`.
- **Deprecation**: STRICTLY FORBIDDEN to use `@deprecated` members or APIs. Always find the modern replacement.
- **Secrets**: NO hardcoded keys or sensitive data.
- **Commits**: Git commit messages must be in Chinese and must NOT contain AI/tool signatures or any CLAUDE-related information.

## 4. Architecture & Patterns
- **Structure**:
  - `lib/core/services/`: Core business logic and services.
  - `lib/features/`: Feature-specific UI and logic.
  - `lib/shared/`: Reusable widgets and utilities.
- **Dependency Injection**: Use Riverpod providers for all service access.
- **ID Generation**: ALWAYS use `IdGenerator.generateId()` for creating content IDs (SHA256 based).
- **Deduplication**: Use `DeduplicationService` for handling duplicate content.

## 5. UI/UX Guidelines
- **Design System**: Material Design 3.
- **Localization**: All user-facing text MUST use `gen-l10n` (AppLocalizations).
- **Accessibility**: Support WCAG 2.1 AA.
- **Performance**: Ensure 60fps. Use `OptimizedImageLoader` for images.

## 6. Testing
- Write unit tests for all new services.
- Write widget tests for complex UI components.
- Run `flutter test` to verify changes.

## 7. Documentation
- Update `.gemini/project_memory.md` if significant architectural changes occur.
- Read `CLAUDE.md` for detailed project history and specific troubleshooting steps.

## 8. Agent Workflow Expectations
- Respond in Chinese while keeping any code comments in English.
- Prefer straightforward, reusable solutions and avoid over‑engineering.
- Watch cyclomatic complexity and reuse modules or helpers whenever possible.
- Apply design patterns only when they simplify modules and reinforce clear boundaries.
- Scope edits to the relevant module to avoid unnecessary cross‑feature impact.

## 9. Advanced Flutter Guidelines
- **Riverpod**: Prefer `NotifierProvider` and `AsyncNotifierProvider` over `StateProvider`. Use `autoDispose` by default unless caching is explicitly required.
- **Immutability**: All State and Model classes MUST be immutable. Use `freezed` or `equatable`.
- **Widgets**: 
  - ALWAYS use `const` constructors where possible.
  - Split large build methods into separate `StatelessWidget` classes, NOT helper methods.
- **Platform Channels**: Wrap ALL `MethodChannel` calls in `try-catch` handling `PlatformException`.
- **Assets**: Avoid hardcoded asset strings. Use generated asset classes or constants.

## 10. Project Specific Standards
- **Naming**: Use descriptive suffixes for files: `_page.dart`, `_widget.dart`, `_repository.dart`, `_service.dart`, `_provider.dart`.
- **Database**: 
  - Complex updates MUST use `transaction`.
  - Schema changes MUST include version migration scripts.
- **Desktop UX**: 
  - All interactive elements MUST be keyboard accessible (Focusable).
  - Support standard shortcuts (Enter to submit, Esc to cancel) in dialogs/forms.